---
interface Slide {
  image: string;
  title: string;
  project: string;
}

interface Props {
  slides: Slide[];
}

const { slides } = Astro.props;
---

<div class="relative overflow-hidden rounded-2xl bg-gray-900 shadow-xl" id="carousel">
  <div class="relative">
    <!-- Slides container -->
    <div id="carousel-track" class="flex transition-transform duration-500 ease-in-out">
      {slides.map((slide, i) => (
        <div class="w-full flex-shrink-0 relative" data-slide={i}>
          <img
            src={slide.image}
            alt={slide.title}
            class="w-full h-[400px] md:h-[500px] object-contain bg-gray-900 p-2"
            loading={i === 0 ? "eager" : "lazy"}
          />
          <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-6">
            <span class="text-accent text-xs font-semibold uppercase tracking-wider">{slide.project}</span>
            <h3 class="text-white font-bold text-lg mt-1">{slide.title}</h3>
          </div>
        </div>
      ))}
    </div>

    <!-- Navigation arrows -->
    <button
      id="carousel-prev"
      class="absolute left-3 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white w-10 h-10 rounded-full flex items-center justify-center transition-colors"
      aria-label="Previous slide"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg>
    </button>
    <button
      id="carousel-next"
      class="absolute right-3 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white w-10 h-10 rounded-full flex items-center justify-center transition-colors"
      aria-label="Next slide"
    >
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
    </button>
  </div>

  <!-- Dots -->
  <div class="flex justify-center gap-2 py-4 bg-gray-900">
    {slides.map((_, i) => (
      <button
        class="carousel-dot w-2.5 h-2.5 rounded-full transition-colors"
        class:list={[i === 0 ? 'bg-accent' : 'bg-gray-600']}
        data-dot={i}
        aria-label={`Go to slide ${i + 1}`}
      />
    ))}
  </div>
</div>

<script>
  const track = document.getElementById('carousel-track') as HTMLElement;
  const prevBtn = document.getElementById('carousel-prev');
  const nextBtn = document.getElementById('carousel-next');
  const dots = document.querySelectorAll('.carousel-dot');
  const totalSlides = dots.length;
  let current = 0;
  let autoTimer: ReturnType<typeof setInterval>;

  function goTo(index: number) {
    current = ((index % totalSlides) + totalSlides) % totalSlides;
    track.style.transform = `translateX(-${current * 100}%)`;
    dots.forEach((dot, i) => {
      dot.classList.toggle('bg-accent', i === current);
      dot.classList.toggle('bg-gray-600', i !== current);
    });
  }

  function startAuto() {
    autoTimer = setInterval(() => goTo(current + 1), 5000);
  }

  function resetAuto() {
    clearInterval(autoTimer);
    startAuto();
  }

  prevBtn?.addEventListener('click', () => { goTo(current - 1); resetAuto(); });
  nextBtn?.addEventListener('click', () => { goTo(current + 1); resetAuto(); });
  dots.forEach((dot) => {
    dot.addEventListener('click', () => {
      goTo(Number((dot as HTMLElement).dataset.dot));
      resetAuto();
    });
  });

  startAuto();
</script>
